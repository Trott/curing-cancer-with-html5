<!DOCTYPE html>
<html>
<head>
  <title>Curing Cancer with HTML5</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <style type="text/css">
    @import url(http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
    @import url(http://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
    @import url(http://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

    body { 
      font-family: 'Droid Serif';
    }
    h1, h2, h3 {
      font-family: 'Yanone Kaffeesatz';
      font-weight: normal;
    }
    img { width: 100%; }
    .remark-slide-content {
      color: white;
      background-color: black;
    }
    .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }
  </style>
</head>
<body>
  <textarea id="source">

class: center, middle

# Curing Cancer with HTML5

Rich Trott  
HTML5DevConf  
October 2014  
San Francisco  

---

class: center, middle

# Spoiler alert!

*We're not actually going to cure cancer with HTML5...*

???

There are two things wrong with this talk's title. I'm not curing cancer (although some of the users are trying to, which is why the title is what it is). And this talk isn't really about HTML5. It's about designing a search experience.

---

class: center, middle

# OMG

*False advertising!*

???

So yeah, "omg! false advertising!""

---

class: center, middle

# Speaking of questionable advertising....

<video controls=1 width=640 height=480 src="video/doctor.mov"></video>

???

Speaking of problematic advertising, let's go back to 1951.

(Plan b: https://www.youtube.com/watch?v=hxUZI0vE0FM)

(Plan c: http://legacy.library.ucsf.edu/tid/xrw93b00/pdf)

If you only take one thing from this talk, it should be that if you want to be healthy, smoke Camel cigarettes!

Let's fast foward now to 1983...

---

class: center, middle

![Letter from Sylvester Stallone agreeing to smoke in his movies in exchange for $500,000.](img/tmq36b00.jpg)

???

Absolutely shameful. I mean, every person in this room knows that it ought
to be "no *fewer* than five feature films" and not "no *less* than 5", right? 
Just shameful.

Fast forward again to 2002. 

---

class: center, middle

# "Shocked and horrified!"

*The Slow Poisoners*

???

I was in a band called, appropirately enough, The Slow Poisoners. We wrote to 
B&amp;W telling them that we were (and I quote) "shocked and horrified" that 
they paid Stallone a half million dollars to smoke in movies...because *we* would
be happy to smoke their products on stage for a tiny fraction of that money.

---

class: center, middle

# "Extremely tempting!"

*Brown &amp; Williamson*

???

One of the B&amp;W lawyers must have had a good sense of humor, because he wrote us
back to tell us that our offer was (and, again, I quote) "extremely tempting". 
However, he went on to say, that sort of promotion would put them in violation of something 
called The Master Settlement. So, they had to turn us down.

---

class: center, middle

# Dude, where's your presentation?

???

What does any of this have to do with the web?

---

class: center, middle

# Tobacco Master Settlement Agreement

Look it up on Wikipedia if you want details.

???

Well, that Master Settlement alluded to by the B&amp;W lawyer had a lot of effects.
But the one we care about here is this...

---

class: center, middle


![Screenshot of http://legacy.library.ucsf.edu](img/legacy_home.png)

???

The Master Settlement ultimately resulted in this site, run by my employer, the
UC San Francisco Library. It contains millions and millions--literally!--of internal
corporate documents from the tobacco industry, searchable by anyone! The "Which cigarette do
you smoke, doctor?" commercial and the letter from Sylvester Stallone are both examples of 
documents that are on the site. And we're adding new documents all the time as they become available.

The site was launched in 2002. Unfortunately, while the content is amazing and hugely 
valuable, the site itself has not kept up with the times.

---

class: center, middle

# User-centered redesign

???

So, we engaged in a user-centered redesign. 

Which is a UX term. 

So I'm going to wave my hands and act like I know what it means.

But I'm assured by people more knowledgable than I am that it means what it sounds like it means: Every decision about how the site will work starts from the point of view of the target user’s needs.

---

class: center, middle

# Novice, motivated, and super users

???

So, we had to identify our target users.

Then we had to engage with these target users to identify their actual needs rather than assuming we already understood their needs.

I'll wave my hands some more and say that we identified three target users. And these categories probably won't surprise anyone.

The novice user has little or no experience with the site.

The motivated user has not been trained on how to use the site, but is willing to dig in and be persistent.

The super user has gone through our training and knows how to construct complex search queries.

And one thing is for sure: The current site caters to super users.

---

class: center, middle

![Screenshot of top of http://legacy.library.ucsf.edu/action/search/basic?fd=0&amp;q=curing+cancer](img/legacy_results_top.png)

???

I mean, check out these myriad options and inexplicable metadata categories.

Seriously, just soak that in for a second or two.

Don't miss all those tabs!

And be sure you know whether you want Advanced Search or Expert Search! Because they're not the same thing!

---

class: center, middle

![Screenshot of middle of http://legacy.library.ucsf.edu/action/search/basic?fd=0&amp;q=curing+cancer](img/legacy_results_scroll.png)

???

Check out the metadata.

Date 00000000!

Bates! Thank Heavens they included the Bates! Whatever that is.

---

class: center, middle

![Screenshot of detailed result](img/bates_master.png)

???

As you explore more results, you may notice that some records don't just have a Bates metadata field, but that they also have, as this one does, a...Master...Bates metadata field. 

I don't want to belittle the incredibly hard work that went into building this site, nor do I want to suggest that it hasn't been wildly successful by many metrics. 

However, when you see something like this, you might be forgiven for thinking that a few corners were cut in the whole "thinking everything through" in the user interface department. 

---

class: center, middle

# Hands-off observation, casual interviews, and user testing

???

So we decided to think it through. We started by watching people using the site
without any guidance as to what we wanted to do with it. We weren't creepy about it.
We asked them to let us watch them.

We also engaged in casual interviews with users.

Lastly, we performed task-based user testing. "Do this with the site, user! Do it now!"

---

class: center, middle

# Expectations, needs, likes, dislikes

???

We then tried to tease out:

what these users expect from the search experience

what they need to feel successful

what they love about the current site

and what they want changed about the current site

---

class: center, middle

# Make everyone feel like an expert.

???

One of the resulting key takeaways is that we want everyone to feel like an expert.

So let's have one search page with prominent faceting options.

Or if we really need a separate advanced search page, let's at least not have an advanced search page *and* an expert search page. Because, seriously?

We'll also use term suggestion to help the user learn how to search.

---

class: center, middle

![Screenshot of http://legacy.library.ucsf.edu](img/legacy_home.png)

???

On the front end, it's not immediately obvious that the main thing you do with the site is search for documents. There's a lot of stuff there, none of which is as important as the search box.

---

class: center, middle

# Show the document contents right away

???

The results should show the document contents right away rather than a butt-ton of metadata.

This let's the user immediately assess the document's value.

---

class: center, middle

# Google-like

???

Start showing results before the user submits the form.

Update the results as the user facets.

Help the user craft good queries through term suggestion as their typing. 

One search page, OK *maybe* two, but not several.

---

class: center, middle

# Make the overwhelming results page whelming

???

Display only key fields

Logged in users can set preferences if they want to see all metadata on the results page

Considered implementing infinite scroll so lots of results wouldn't feel like lots of results. 

---

class: center, middle

# Analytics

???

75% of the site traffic originated from external search engines like Google. 

Once these users got to our site, they were plugging in broad search terms (like *tobacco* or *cancer*) that returned an overwhelming number of results.  

This meant that most of our users were novices and motivated users, not the super users we were used to thinking about and catering to.

---

class: center, middle

# The Challenge

???

Build an easy-to-use search engine&hellip;

&hellip;that teaches users how to return quality results&hellip;

&hellip;without dumbing down the experience for our super users.

---

class: center, middle

![Motivated user scenario](img/scenario.png)

???

Here's a scenario for a motivated user. 

Scenarios help us clarify our thinking and uncover issues we've missed.

Here, we see the issues getting to a reasonable number of relevant results. This story highlighted a key pain point with our initial proposed flow: expanding the search beyond the initial scope is impossible&emdash;you have to start your search over again.  

---

class: center, middle

# Things I wish we had done&hellip;

&hellip;TDD, mobile-first, decoupling from middleware&hellip;

---

class: center, middle

# D3? stuff like that? Yeah? No?

???

Actually, list the tech we're using, eh? JS libs/frameworks, Less, etc. Of course,
then you have to be prepared to justify these choices. *sad trombones*

---

class: center, middle

# Anything about Library search?

???

Before/after screenshot

It's now an API so anyone can make a new interface that's better than ours or more specialized/customized or a mashup

Tech stack change (Drupal -> Foundation + Node)

Links go directly to results, hopefully

Oh, look, you can open a link in a new tab.

There is surprisingly little published research on measuring search success/user satisfaction. Lots of research, just a lot of it is trade secrets.

To record a click-through rate baseline, would need to start logging what results get served but not clicked. Let's try something easier...

Record whether results clicks vs. search clicks. And let's do it in an automated way.

amalgamatic! Try it! No enterprise Java skillz or license necessary. Write plugins! Would love to browserify it and just have a local metasearch, but, you know, cross-origin. Might be useful for a browser extension, though.

---

Academic libraries offer many resources, but users cannot be expected to search in, say, a half dozen different interfaces to find what they're looking for. So academic libraries typically offer <a href="https://en.wikipedia.org/wiki/Federated_search">federated search</a>.

Sometimes, a solution is purchased. Many libraries, for example, use <a href="http://www.proquest.com/products-services/360-Search.html">360 Search</a>. 

Here at UCSF, we are among the libraries that have built our own federated search. Twice.

There are (at least) three ways to pull data out of other resources in real time.
<ol>
  <li><p><b>Cool, they have an API for that!</b>
<i>This almost never happens.</i></p></li>
  <li><p><b>I will screen-scrape the #*%!?@ out of your website!</b>
<i>This is by far the most common scenario.</i></p></li>
  <li><p><b>Web New-dot-Oh: It's full of JavaScript that injects the content.</b>
<i>An edge case, but one that is becoming more important all the time. Make friends with <a href="http://phantomjs.org/">PhantomJS</a> to scrape these sites.</i></p></li>
</ol>

When trying to implement these solutions, a common scenario is to build your screen-scraping federated search tool with traditional server-side languages like Java or PHP. 

These strategies and technologies bring with them pitfalls to be avoided. Recompiling your WAR every time one of your target systems modifies their HTML layout, anyone?

Here's another pitfall: Our group built a solution years ago (our first one) that is implemented in Drupal with no external facing API. So, if I want to experiment with a different results interface, I need to write it in Drupal. This tight coupling prevents experimentation with other technologies or things that don't fit neatly into the Drupal paradigm.

A lot of the pitfalls can be avoided by following sound software architecture principles. But one thing should be uncontroversial:

<strong>No programming language has a more robust and widely-understood set of conventions and tools for processing blobs of HTML than JavaScript.</strong>

So how about building your federated search server using Node.js? Or maybe even take it a step further and just let your user's browser execute the federated search entirely by itself, no need to talk to your server! If it's all just JavaScript, why not?

That is our approach this second time around.

First, we wrote <a href="https://github.com/ucsf-ckm/amalgamatic">a pluggable, extensible federated search tool called Amalgamatic</a>.

Second, we wrote <a href="https://www.npmjs.org/browse/keyword/amalgamatic-plugin">the plugins that we needed</a> to search the resources we were interested in: 

<ul>
<li><a href="https://github.com/ucsf-ckm/amalgamatic-pubmed">PubMed</a></li>
<li><a href="https://github.com/ucsf-ckm/amalgamatic-sfx">SFX</a></li>
<li><a href="https://github.com/ucsf-ckm/amalgamatic-libguides">LibGuides</a></li>
<li><a href="https://github.com/ucsf-ckm/amalgamatic-millennium">Millennium OPAC</a></li>
<li><a href="https://github.com/ucsf-ckm/amalgamatic-drupal6">Drupal 6</a> (to include our own website contents in the search results)</li>
<li><a href="https://github.com/ucsf-ckm/amalgamatic-ucsflibdbs">our curated list of databases</a></li>
</ul>

In the course of writing these plugins, we used all three of the techniques described above (API, scraping HTML, and using a headless browser to get JavaScript-generated content).

Third, we used Amalgamatic to <a href="http://developer.ucsf.edu/doc/library/#search">expose federated search on our API server</a>. (<a href="https://github.com/Trott/apis.ucsf.edu/blob/master/routes/library.js">source code</a>)

Fourth, <a href="http://search.library.ucsf.edu/">we set up a prototype search interface to use that API</a>. (<a href="https://github.com/ucsf-ckm/search.library.ucsf.edu">source code</a>)

Lastly, because we could, we used <a href="http://browserify.org/">Browserify</a> to create <a href="https://trott.github.io/demo-amalgamatic-browserify">a demo showing how to use Amalgamatic so that all the retrieval and processing happens in the browser</a>&mdash;no need for an intermediary API or search server! (<a href="https://github.com/Trott/demo-amalgamatic-browserify">source code</a>) 

I hope others find this work useful. <a href="https://github.com/ucsf-ckm/amalgamatic">Use Amalgamatic</a>, ask questions, <a href="https://github.com/ucsf-ckm/amalgamatic/issues">file issues for bugs or feature requests</a>, and <a href="https://github.com/ucsf-ckm/amalgamatic/wiki/How-to-write-an-Amalgamatic-plugin">write and publish your own plugins</a>. 

<small>(Or tell me about your project that already does this better and I need to fold up shop or at least steal all your ideas.)</small>

<small><small>While I'm at it with the small-text thing, here's a caveat on the Browserify-ed version: The one thing the browser couldn't do was launch the PhantomJS headless browser for scraping sites that depend on JavaScript execution to display results. Fortunately for us, that was needed in the LibGuides plugin only. And LibGuides offers an API, so if we really wanted LibGuides results, we could use the API. We initially implemented it that way, actually, but found that the API results differed from the LibGuides search page results. We thought that might be confusing to users, so we went with PhantomJS-assisted scraping.</small></small>

---

class: center, middle

# Thanks!!


# Headshot goes here, yo

Rich Trott  
@trott  
UC San Francisco  
Library

???

*Talk about terrible, inflexible Library interfaces (like III) and what we do about it*

*Talk about LTDL2 v. LTDL3?*

*In either event, it's bringing something HTML 4-ish into the modern world.*

  </textarea>
  <script src="js/remark.min.js">
  </script>
  <script type="text/javascript">
  var slideshow = remark.create();
  </script>
</body>
</html>