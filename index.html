<!DOCTYPE html>
<html>
<head>
  <title>Curing Cancer with HTML5</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <style type="text/css">
    @import url(http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
    @import url(http://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
    @import url(http://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

    body { 
      font-family: 'Droid Serif';
    }
    h1, h2, h3 {
      font-family: 'Yanone Kaffeesatz';
      font-weight: normal;
    }
    img { width: 100%; }
    .remark-slide-content {
      color: white;
      background-color: black;
    }
    .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }
  </style>
</head>
<body>
  <textarea id="source">

class: center, middle

# Curing Cancer with HTML5

Rich Trott  
HTML5DevConf  
October 2014  
San Francisco  

???

Hi, everyone! 

Thank you for coming to "Curing Cancer with HTML5"!

---

class: center, middle

# Spoiler alert!

*We're not actually going to cure cancer with HTML5...*

???

Hopefully this is already clear, but HTML5 will not _actually_ cure cancer. 

Neither will I. 

And this talk isn't _actually_ about oncology.

It _is_ about search. 

So why does it have the title "Curing Cancer with HTML5"? 

Because when I wrote up the talk proposal, I was in a rush. 

Where I work, some of our researchers are in fact trying to cure cancer,
boom, there's my title.

Sorry, everyone. I'll try to do better with the title next time.

---

class: center, middle

# We have lots of search interfaces&hellip;

???

I work for the University of California, San Francisco, a health sciences institution. 

That means we have a hospital and lots of researchers, but we have no undergraduate students, no sports teams, no liberal arts programs, no computer science programs.

We also have dozens of online resources for researchers, clinicians, and educators.

Each of these online resources has its own search tool. 

But users shouldn't be asked to search in dozens of different interfaces to find what they're looking for. 

A typical solution for this issue is what's called federated search.

---

class: center, middle


# &hellip;and our federated search kinda sucks&hellip;

???

One of the resources, one that we actually curate and publish ourselves, is called the Legacy Tobacco Documents Library.

It's an awesome collection of, literally, millions of internal tobacco industry documents.

In fact, this talk was originally going to be about that site, because last year, we started a user-centered redesign for the site.

We did tons of user research and found out what was working and wasn't working.

But as it turns out, our federated search suffers from many of the same problems identified for the tobacco industry documents site.

---

class: center, middle

# &hellip;so we made it suck less.

???

So it was time to do something about it.

And again, this was originally going to be about the tobacco industry documents site, not our federated search. 

I had included in an amazing old Camel cigrattes ad called "What Cigarette Do You Smoke Doctor?"

I had included Sylvester Stallone's letter agreeing to be paid a half a million dollars to smoke Brown &amp; Williamson tobacco products in feature films.

I was going to talk about the overwhelming amount of metadata we showed users by default including something called&mdash;and I swear I'm not just making this up&mdash;a Bates Number and a Master Bates Number.

But sometime in the last 48 hours, I realized I ought to talk about the basic building blocks, especially if I only have 20 minutes to talk.

So I junked my hilarious awesome entertaining talk, and now you get this more pragmatic, narrowly-focused talk.

But if you want to see that Camel ad and talk about poor choices made in naming metadata, come talk to me.

---

class: center, middle

# So, about federated search...

???

So, we're not just making search suck less for the user. We're making it suck less for ourselves too.

There are (at least) three ways to pull data out of other resources in real time. In descending order of desirability, here they are.

---

class: center, middle

# Cool, they have an API for that!

This almost never happens.

???

Number 1: The content provider might publish an API. But usually not. Or if they do, it's a clunky API designed to create HTML widgets and not deliver JSON data or anything like that. In other words, it's an API meant to serve the publisher and not the consumer.

Still accessing the content provider's API is the most desirable option, of course.

---

class: center, middle 

# Screen-scrape the #*%!?Â out of it.

This is by far the most common scenario.

???

Then there's straightforward grab-the-HTML and scrape the information out of it. Of course, it's brittle because the HTML can change and break your scraper. But it has two big upsides: It usually works well enough, and it is usually easy and fast to implement.

---

class: center, middle 

# Web New-dot-Oh

It's full of JavaScript that injects the content.

???

Then there's your site powered by Angular or Backbone or Ember or whatever. None of the content shows up unless you execute a bunch of JavaScript. Make friends with headless browsers like PhantomJS to scrape these sites.

This should be your last resort, not your first choice. Headless browsers are fast compared to Safari and Internet Explorer, but they're slow compared to curl or API calls.

---

class: center, middle

# Pitfalls

???

When trying to implement these solutions, a common scenario is to build your screen-scraping federated search tool with traditional server-side languages like Java or PHP. 

These strategies and technologies bring with them pitfalls to be avoided. Recompiling your WAR every time one of your target systems modifies their HTML layout, anyone? Anyone? Who's with me?

---

class: center, middle

# "My solution only works in Drupal!"

???

Here's another pitfall: Our group built a solution years ago (our first one) that is implemented in Drupal with no external facing API. So, if I want to experiment with a different results interface, I need to write it in Drupal. This tight coupling prevents experimentation with other technologies or things that don't fit neatly into the Drupal paradigm.

---

class: center, middle

# JavaScript FTW

???

A lot of the pitfalls can be avoided by following sound software architecture principles. But one thing should be uncontroversial:

&quot;No programming language has a more robust and widely-understood set of conventions and tools for processing blobs of HTML than JavaScript.&quot;

It's got the DOM built right in. It's got a million battle-tested libraries with simple and powerful jQuery-like selectors. Its sole reason for existing is the Web and HTML!

---

class: center, middle

# Node.js FTW

???

So how about building your federated search server using Node.js? 

---

class: center, middle

# Browserify FTW

???

Or maybe even take it a step further and just let your user's browser execute the federated search entirely by itself, no need to talk to your server! If it's all just JavaScript, why not?

---

class: center, middle

# Amalgamatic

github.com/ucsf-ckm/amalgamatic

???

First, we wrote a pluggable, extensible federated search tool called Amalgamatic.

---

class: center, middle

# Amalgamatic plugins

www.npmjs.org/browse/keyword/amalgamatic-plugin

???

Second, we wrote the plugins that we needed to search the resources we were interested in.

In the course of writing these plugins, we used all three of the techniques described above (API, scraping HTML, and using a headless browser to get JavaScript-generated content).

---

class: center, middle

# API server

Node.js, Express

???

Third, we used Amalgamatic to expose federated search on our Node.JS-powered API server.

---

class: center, middle

# Federated search prototype

search.library.ucsf.edu

???

Fourth, we set up a prototype search interface to use that API.

Obligatory HTML5 API shoutout to EventSource! If you don't know it, look it up, it rules. It's one of the unsung majesticly awesome APIs, powerful and simple, and it doesn't get the attention it deserves.

---

class: center, middle

# Browserified Demo

trott.github.io/demo-amalgamatic-browserify

???

Lastly, because we could, we used Browserify to create a demo showing how to use Amalgamatic so that all the retrieval and processing happens in the browser</a>&mdash;no need for an intermediary API or search server! 

A small caveat on the Browserify-ed version: One thing the browser couldn't do was launch the headless browser for scraping sites that depend on JavaScript execution to display results. So maybe there's another reason to keep that as a last resort technique only.

---

class: center, middle

ANOTHER IMAGE?

???

It's now an API so anyone can make a new interface that's better than ours or more specialized/customized or a mashup

Tech stack change (Drupal -> Foundation + Node)

Links go directly to results, not to our description of the result

Oh, look, you can open a link in a new tab.

amalgamatic! Try it! No enterprise Java skillz or license necessary. Browserify it even! Useful for a browser extension as well.

---

class: center, middle

# github.com/ucsf-ckm/amalgamatic

# Thanks!!


Rich Trott  
@trott  
UC San Francisco  
Library

  </textarea>
  <script src="js/remark.min.js">
  </script>
  <script type="text/javascript">
  var slideshow = remark.create();
  </script>
</body>
</html>